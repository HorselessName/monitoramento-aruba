zabbix_export:
  version: '6.2'
  date: '2024-08-28T18:37:10Z'
  template_groups:
    -
      uuid: 7df96b18c230490a9a0a9e2307226338
      name: Templates
  host_groups:
    -
      uuid: 16a5ae6af92f4bec89cc68a4e3d456a4
      name: Aruba
  templates:
    -
      uuid: 3140b327d32842479817deb4cbd9ffef
      template: 'Template Aruba - Tenant Monitoring via API'
      name: 'Template Aruba - Tenant Monitoring via API'
      description: |
        1. Generates Hosts for Company + Site using ARUBA API
        2. Monitors Tenant Insights
        
        Must have Host Group "Aruba Tenant" created for using it with Grafana.
      groups:
        -
          name: Templates
      items:
        -
          uuid: e66ac77f71e249c6932544917c0f3fc0
          name: 'Insights Discovery'
          type: EXTERNAL
          key: 'api_aruba.py["-c","{$CUSTOMER_NAME}","-l","insights"]'
          delay: 15m
          history: 1w
          trends: '0'
          value_type: TEXT
          description: 'Returns the list of the insights of the current company (Tenant), to be used for displaying in Grafana.'
          preprocessing:
            -
              type: JAVASCRIPT
              parameters:
                - |
                  var json = JSON.parse(value);
                  return JSON.stringify(json.insights);
          tags:
            -
              tag: Discovery
              value: Insights
            -
              tag: Insights
              value: Aruba
        -
          uuid: 2aec5b4a837342d8b7ef9290fce028dc
          name: 'Sites Discovery'
          type: EXTERNAL
          key: 'api_aruba.py["-c","{$CUSTOMER_NAME}","-l","sites"]'
          delay: 15m
          history: 1w
          trends: '0'
          value_type: TEXT
          description: 'Returns the site list of the current company, to be used for LLD Discovery'
          preprocessing:
            -
              type: JAVASCRIPT
              parameters:
                - |
                  var json = JSON.parse(value);
                  
                  var data = {
                      data: json.sites
                  };
                  
                  return JSON.stringify(data);
          tags:
            -
              tag: Discovery
              value: Sites
            -
              tag: Sites
              value: Aruba
      discovery_rules:
        -
          uuid: ac3e4ec3358c41a794d1c770f7e4bb38
          name: 'Sites Discovery'
          type: DEPENDENT
          key: 'discovery_constructor[sites]'
          delay: '0'
          description: 'Item Dependente necessário para a Construção dos Protótipos dos Sites do cliente, usado pra gerar os hosts que usam o Template que lista os APs, Switches e Gateways.'
          host_prototypes:
            -
              uuid: 40b09dc035da49119519fb5a7def27e7
              host: 'Aruba_{#HOST_NAME}'
              name: 'Aruba {#CUSTOMER_NAME} - {#SITE_NAME}'
              group_links:
                -
                  group:
                    name: Aruba
              group_prototypes:
                -
                  name: 'Aruba {#CUSTOMER_NAME}'
              templates:
                -
                  name: 'Template Aruba - Tenant Sites Monitoring via API'
              macros:
                -
                  macro: '{$CUSTOMER_NAME}'
                  value: '{#CUSTOMER_NAME}'
                  description: 'Customer in which devices will be queried'
                -
                  macro: '{$SITE_NAME}'
                  value: '{#SITE_NAME}'
                  description: 'Site for querying APs, Gateways, etc.'
              tags:
                -
                  tag: Aruba
                  value: '{#CUSTOMER_NAME}'
                -
                  tag: '{#CUSTOMER_NAME}'
                  value: '{#SITE_NAME}'
              inventory_mode: AUTOMATIC
          master_item:
            key: 'api_aruba.py["-c","{$CUSTOMER_NAME}","-l","sites"]'
          lld_macro_paths:
            -
              lld_macro: '{#SITE_NAME}'
              path: $.site_name
            -
              lld_macro: '{#CUSTOMER_NAME}'
              path: $.company_name
            -
              lld_macro: '{#HOST_NAME}'
              path: $.host_name
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.data[*]'
              error_handler: CUSTOM_VALUE
              error_handler_params: '[]'
      tags:
        -
          tag: Template
          value: Aruba
      macros:
        -
          macro: '{$CUSTOMER_NAME}'
          description: 'Company name to discover sites'
